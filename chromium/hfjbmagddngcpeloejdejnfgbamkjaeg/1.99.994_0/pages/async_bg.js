"use strict";__filename="pages/async_bg.js",define(["require","exports"],function(n,e){var t,o,u,i,r,c,l,a,f,s,d,m,v,p,h,g,b,y,w,V,k,j,q,A,K,M,C,O,P;Object.defineProperty(e,"__esModule",{value:true}),e.Qt=e.Hn=e.Ln=e.Sn=e.Kn=e.Nn=e.m=e.Xn=e.y=e._n=e.V=e.R=e.Lt=e.En=e.$$=e.$=e.An=e.O=e.In=e.On=e.un=e.P=e.Tn=e.Mn=e.Yn=e.Pt=e.Bn=e.OnSafari=e.OnEdge=e.OnFirefox=e.OnChrome=void 0,e.OnChrome=true,e.OnFirefox=!!0,e.OnEdge=!!0,e.OnSafari=!!0,t=navigator.userAgentData,e.Bn=(o=t&&(t.brands||t.uaList))?!!o.find(function(n){return n.brand.includes("Edge")||n.brand.includes("Microsoft")}):matchMedia("(-ms-high-contrast)").matches,e.Pt=o&&(u=o.find(function(n){return n.brand.includes("Chromium")}))&&parseInt(u.version)>82?parseInt(u.version):(M=navigator.userAgent.match(/\bChrom(?:e|ium)\/(\d+)/))?75==+M[1]&&matchMedia("(prefers-color-scheme)").matches?81:0|M[1]:998,e.Yn=999,e.Tn=9,i=function(n){e.Tn=n},e.P=i,e.un=chrome,e.On=new Promise(function(n){var t;r=new Promise(function(n){t=n}),addEventListener("VimiumC",function o(){e.Pt<55&&removeEventListener("VimiumC",o,true),w(t),e.V(n)},{once:true,capture:true})}),c=4,l=new Map,a=null,f=null,s=null,d=Object.create(null),m=1,v=null,e.In=-1,p=function(n){var e,t,o;if(v&&(f=0),false!==n){for(e=d[n.i],delete d[n.i],t=n.a,o=0;o<e.length;o++)e[o](t[o]);VApi&&v&&0===Object.keys(d).length&&y()}else alert("Can not send info to the background: not trusted")},h=function(){v=0,console.log("[WARNING] the temp port is disconnected unexpectedly; need to replay messages using VApi"),f&&r.then(function(){var n,e,t,o=f,u=o?Object.keys(d):[];for(n of(f=0,u))e=d[n],(t=o[n])&&e&&(a=t,s=e,g(t.length))})},g=function(n){var t,o,u,i,r;a&&(t=VApi,(o=a.length)>(n||1)?w(g.bind(null,o)):(t&&v&&0===Object.keys(d).length&&y(),0!==n?(u=m++,d[u]=s,s=null,(r=(i=e.un.extension.getBackgroundPage)&&i())&&r.onPagesReq?r.onPagesReq({i:u,q:a}).then(p):t?t.r[0](40,{i:u,q:a},p):(null==v&&((v=e.un.runtime.connect({name:"128"})).onMessage.addListener(p),v.onDisconnect.addListener(h)),v&&v.postMessage({H:40,i:u,q:a}),0!==f&&((f||(f=Object.create(null)))[u]=a)),a=null):a=s=null))},e.O=function(n,e){return new Promise(function(t){a||b(),a.push({n:n,q:void 0!==e?e:null}),s.push(t)})},e.An=b=function(){a||(a=[],s=[],w(g))},y=function(){var n=v;v=null,n&&(n.onDisconnect.removeListener(h),n.onMessage.removeListener(p),n.disconnect())},w=globalThis.queueMicrotask?queueMicrotask:function(n){Promise.resolve().then(n)},e.$=function(n){return document.querySelector(n)},e.$$=function(n,e){var t=(e||document).querySelectorAll(n);return[].slice.call(t)},e.En=function(n){var e,t=document.head.querySelector("meta[name=color-scheme]"),o=2===n?"light dark":1===n?"dark":"light";t.content!==o&&(t.content=o,(e=document.documentElement.classList).toggle("no-dark",!n),e.toggle("dark",1===n))},e.Lt=function(n){document.documentElement.classList.toggle("less-motion",n)},e.V=(C=function(){var n,e=O.length;for(n=0;n<e;n++)(0,O[n])();O.length>e?(O.splice(0,e),w(C)):O.length=0},O=[],e.R=function(n,e){7==(c=(c|n)&~(e||0))&&w(C)},function(n,e){var t;O.length<=0&&7===c&&w(C),9===e?O.unshift(n):(t=e?n.bind(null,e):n,O.push(t))}),e._n=function(n){return define([n])},e.y=function(n,e){var t=l.get(n);return null!=e&&t&&(t=t.replace(/\$\d/g,function(n){return e[+n[1]-1]})),t},V=function(n,e){return n&&n.split(" ").reduce(function(n,t){return n||(t.includes("=")?t.startsWith(e)?t.slice(e.length+1):n:t)},"")},e.Xn=e.un.i18n.getMessage,k=location.pathname.replace("/pages/","").split(".")[0],j=e.Xn("lang1"),e.m=V(e.Xn("i18n"),k)||j||"en",A=function(n){var t,o,u,i=l;for(t of n.reverse())if(t)for(u in o=q?t.default:JSON.parse(t.slice(14)))i.set(u,o[u]);e.R(2)},e.Nn=(q=false)?A:0,e.Kn=q?k:0,Promise.all(e.m.split(",").map(function(n){var e="/i18n/".concat(n,"/").concat("show"===k?"popup":k,".").concat("js");return fetch(e).then(function(n){return n.text()}).catch(function(n){return console.log("Can not load the language file:",e,":",n),null})})).then(A),P=function(n,e){return new Promise(function(t){var o=t.bind(0,void 0),u=n.call(e),i=function(n){var e=u.next(n);Promise.resolve(e.value).then(e.done?t:i,o)};i()})},globalThis.__awaiter=function(n,e,t,o){return P(o,n)};e.Pt>75&&e.un.storage.local.get("autoDarkMode",function(n){var t=n&&n.autoDarkMode;return(false===t||1===t||0===t)&&e.En(t?1:0),e.un.runtime.lastError}),j&&"popup"!==k&&(K=e.Xn("v"+k))&&(document.title="Vimium C "+K),"options"===k&&e.On.then(function(){VApi.r[0](40,{i:1,q:[{n:26,q:null}]},function(n){false!==n&&(e.In=n.a[0])})}),e.Sn=function(n,e){var t;return e=e||{ctrlKey:false,altKey:false,shiftKey:false,metaKey:false},t=new MouseEvent("click",{bubbles:true,cancelable:true,composed:!0,view:window,detail:1,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey,button:0,buttons:1,relatedTarget:null}),n.dispatchEvent(t)},e.Ln=function(n){return n.shiftKey},e.Hn=function(n){return n.repeat},e.Qt=function(n){n.preventDefault();var t="keydown"===n.type?n.keyCode:0;!t||!e.Tn&&n.metaKey||VApi&&(VApi.a()[t]=1)},"undefined"==typeof VApi&&(globalThis.VApi=void 0)});